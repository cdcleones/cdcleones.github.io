<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<!--<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">-->

<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/style.css">
<link rel="stylesheet" type="text/css" href="css/font-awesome.css">
<link rel="stylesheet" type="text/css" href="css/animate.css">


<link rel="stylesheet" type="text/css" href="css1/jquery.dataTables.min.css">

<script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="js1/jquery.dataTables.min.js"></script>


<script type="text/javascript" src="js/races.js"></script>

<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery-scrolltofixed.js"></script>
<script type="text/javascript" src="js/jquery.nav.js"></script> 
<script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="js/jquery.isotope.js"></script>
<script type="text/javascript" src="js/wow.js"></script> 
<script src="contact/jqBootstrapValidation.js"></script>
<script src="contact/contact_me.js"></script>
<script type="text/javascript" src="js/custom.js"></script>

<script>

var arrSocios;
var arrConcursos;

function leeSocios(anio){
  var arrTemp = [];
  $.getJSON('socios.txt', function(datosSocios){
	for (var i=0; i<datosSocios.length; i++){
	  if (datosSocios[i].anio==anio){
		var nuevo = {socio:datosSocios[i].socio,nombre:datosSocios[i].nombre,activo:datosSocios[i].activo};
		arrTemp.push(nuevo);
	  }
	}
  });
  return arrTemp;
}

function leeConcursos(anio){
  var arrTemp = [];
  $.getJSON('concursos.txt', function(datosConcursos){
	for (var i=0; i<datosConcursos.length; i++){
	  if (datosConcursos[i].anio==anio){
		var nuevo = {codigo:datosConcursos[i].codigo,nombre:datosConcursos[i].nombre,activo:datosConcursos[i].activo};
		arrTemp.push(nuevo);
	  }
	}
  });
  return arrTemp;
}

function dimeNombreSocio(sSocio){
  for (var i=0; i<arrSocios.length; i++){
	if (arrSocios[i].socio==sSocio){
	  return(arrSocios[i].nombre.toUpperCase());
	}
  }
}

function dimeNombreConcurso(sConcurso){
  for (var i=0; i<arrConcursos.length; i++){
	if (arrConcursos[i].codigo==sConcurso){
	  return(arrConcursos[i].nombre.toUpperCase());
	}
  }
}
$(document).ready(function(){
  
  arrSocios = leeSocios(2018);
  arrConcursos = leeConcursos(2018);
  
  $("#get_btn").click(function(){
	$.getJSON('carreras.txt', function(datos){
	  /*console.log(datos);
	  var ssocios='<ul>';
	  for (var i=0;i<datos.length;i++){
		ssocios+="<li>"+datos[i].concurso+" - "+datos[i].anilla+"</li>";
	  }
	  ssocios+="</ul>";
	  $("#salida").html(ssocios);
	  */
/*	  
	  var arrCarreras = [];
	  for (var i=0; i<datos.length; i++){
		var nuevo = {posicion:datos[i].pos,anilla:datos[i].anilla,pais:datos[i].pais,concurso:datos[i].concurso,socio:datos[i].socio,puntos:datos[i].puntos};
		arrCarreras.push(nuevo);
	  }
*/
	  var arrPalomas = [];
	  var encontrada;
	  for (var i=0; i<datos.length; i++){
		encontrada=false;
		for (var j=0; j<arrPalomas.length; j++){
		  if (datos[i].anilla==arrPalomas[j].anilla){
			encontrada=true;
			break;
		  }
		}
		if (!encontrada){
		  var nueva = {anilla:datos[i].anilla,pais:datos[i].pais,socio:datos[i].socio,misdatos:datos[i].concurso+" ("+datos[i].pos+/*", "+datos[i].puntos+*/")",clasificada:1};
		  arrPalomas.push(nueva);
		}
		else{
		  arrPalomas[j].misdatos+=", "+datos[i].concurso+" ("+datos[i].pos+/*", "+datos[i].puntos+*/")"
		  arrPalomas[j].clasificada+=1;
		}
	  }
	  
	  arrPalomas.sort(function (a, b) {
		return b.clasificada - a.clasificada;
	  });
	  
	  
	  var sSalida='<ul>';
	  for (var i=0; i<arrPalomas.length; i++){
		sSalida+="<li>"+(i+1)+" - "+arrPalomas[i].clasificada+" - "+arrPalomas[i].anilla+" - "+arrPalomas[i].pais+" - "+dimeNombreSocio(arrPalomas[i].socio)+" - "+arrPalomas[i].misdatos+"</li>";
	  }
	  sSalida+="</ul>";
	  $("#salida").html(sSalida);
	});
  });
  
  $("#get_btn1").click(function(){
	$.getJSON('carreras.txt', function(datos){
	  var arrPalomas = [];
	  var encontrada;
	  for (var i=0; i<datos.length; i++){
		encontrada=false;
		for (var j=0; j<arrPalomas.length; j++){
		  if (datos[i].anilla==arrPalomas[j].anilla){
			encontrada=true;
			break;
		  }
		}
		if (!encontrada){
		  if (datos[i].concurso.charAt(datos[i].concurso.length-2)=='N'){
			var nueva = {anilla:datos[i].anilla,pais:datos[i].pais,socio:datos[i].socio,misdatos:"<abbr title='"+dimeNombreConcurso(datos[i].concurso)+"'>"+datos[i].concurso+"</abbr>: "+datos[i].pos+"ª",puntos_nac:datos[i].puntos};
			arrPalomas.push(nueva);
		  }
		}
		else{
		  if (datos[i].concurso.charAt(datos[i].concurso.length-2)=='N'){
			arrPalomas[j].misdatos+=", "+"<abbr title='"+dimeNombreConcurso(datos[i].concurso)+"'>"+datos[i].concurso+"</abbr>: "+datos[i].pos+"ª";
			arrPalomas[j].puntos_nac+=datos[i].puntos;
		  }
		}
	  }
	  arrPalomas.sort(function (a, b) {
		return b.puntos_nac - a.puntos_nac;
	  });
	  

	  //var sSalida="<table id='tablepodium1' class='display'>";
	  var sSalida="<table id='mejorespalomas' class='display' style='width:100%'>";
	  sSalida+="<thead><tr><th>#</th><th>País</th><th>Anilla</th><th>Nombre</th><th>Posiciones</th><th>Puntos</th></tr></thead>";
	  sSalida+="<tbody>";
	  
	  for (var i=0; i<arrPalomas.length; i++){
		sSalida+="<tr>";
		sSalida+="<th>" + (i+1) +"</th>";
		sSalida+="<td>"+arrPalomas[i].pais+"</td><td>"+arrPalomas[i].anilla+"</td><td>"+dimeNombreSocio(arrPalomas[i].socio)+"</td><td>"+arrPalomas[i].misdatos +"</td><td>"+Number(arrPalomas[i].puntos_nac).toFixed(2)+"</td>";
		sSalida+="</tr>";
	  }
	  
	  sSalida+="</tbody>";
	  sSalida+="</table>";
	  $("#salida").html(sSalida);

	});


	
	$('#mejorespalomas').DataTable( {
		//retrieve: true,
		responsive: true,
		paging: true,
		"language": {
			"emptyTable": "No hay datos disponibles en la tabla",
			"infoEmpty": "Mostrando 0 a 0 de 0 registros",
            "decimal": ",",
            "thousands": ".",
			"lengthMenu": "Mostrar _MENU_ registros por página",
			"search" : "Buscar",
			"paginate": {
				"first": "Primero",
				"last": "Último",
				"next": "Siguiente",
				"previous": "Anterior"
			},
			"info": "Mostrando página _PAGE_ de _PAGES_",
            "infoFiltered": "(Filtrando de un total de _MAX_ registros)"
        },
		columnDefs: [
			{ targets: [0,5], className: 'dt-body-right' }
		]
	} );
	
  });

  $("#get_btn2").click(function(){
	$.getJSON('carreras.txt', function(datos){
	  var arrPalomas = [];
	  var encontrada;
	  for (var i=0; i<datos.length; i++){
		encontrada=false;
		for (var j=0; j<arrPalomas.length; j++){
		  if (datos[i].anilla==arrPalomas[j].anilla){
			encontrada=true;
			break;
		  }
		}
		if (!encontrada){
		  if (datos[i].concurso.charAt(datos[i].concurso.length-2)!='N'){
			var nueva = {anilla:datos[i].anilla,pais:datos[i].pais,socio:datos[i].socio,misdatos:"<abbr title='"+dimeNombreConcurso(datos[i].concurso)+"'>"+datos[i].concurso+"</abbr>: "+datos[i].pos+"ª",puntos_reg:datos[i].puntos};
			arrPalomas.push(nueva);
		  }
		}
		else{
		  if (datos[i].concurso.charAt(datos[i].concurso.length-2)!='N'){
			arrPalomas[j].misdatos+=", <abbr title='"+dimeNombreConcurso(datos[i].concurso)+"'>"+datos[i].concurso+"</abbr>: "+datos[i].pos+"ª";
			arrPalomas[j].puntos_reg+=datos[i].puntos;
		  }
		}
	  }
	  arrPalomas.sort(function (a, b) {
		return b.puntos_reg - a.puntos_reg;
	  });
	  

	  //var sSalida="<table id='tablepodium2'>";
	  var sSalida="<table id='mejorespalomas' class='display' style='width:100%'>";
	  sSalida+="<thead><tr><th>#</th><th>Pais</th><th>Anilla</th><th>Nombre</th><th>Posiciones</th><th>Puntos</th></tr></thead>";
	  sSalida+="<tbody>";
	  
	  for (var i=0; i<arrPalomas.length; i++){
		sSalida+="<tr>";
		sSalida+="<th>" + (i+1) +"</th>";
		sSalida+="<td>"+arrPalomas[i].pais+"</td><td>"+arrPalomas[i].anilla+"</td><td>"+dimeNombreSocio(arrPalomas[i].socio)+"</td><td>"+arrPalomas[i].misdatos +"</td><td>"+Number(arrPalomas[i].puntos_reg).toFixed(2)+"</td>";
		sSalida+="</tr>";
	  }
	  
	  sSalida+="</tbody>";
	  sSalida+="</table>";
	  $("#salida").html(sSalida);

	});
	
	
	$('#mejorespalomas').DataTable( {
		//retrieve: true,
		responsive: true,
		paging: true,
		"language": {
			"emptyTable": "No hay datos disponibles en la tabla",
			"infoEmpty": "Mostrando 0 a 0 de 0 registros",
            "decimal": ",",
            "thousands": ".",
			"lengthMenu": "Mostrar _MENU_ registros por página",
			"search" : "Buscar",
			"paginate": {
				"first": "Primero",
				"last": "Último",
				"next": "Siguiente",
				"previous": "Anterior"
			},
			"info": "Mostrando página _PAGE_ de _PAGES_",
            "infoFiltered": "(Filtrando de un total de _MAX_ registros)"
        },
		columnDefs: [
			{ targets: [0,5], className: 'dt-body-right' }
		]
	} );
	
	
  });
  


  
});


</script>

<style type="text/css">
#container
{
  width:80%;
  margin-left:10%;
}
</style>

</head>
<body>
<br /><br />
<div class="container">
<!--  <button id="get_btn">Cargar datos</button>-->
  <button id="get_btn1">Mejor paloma nacional</button>
  <button id="get_btn2">Mejor paloma regional</button>
  <br /><br />
  <div id="salida"></div>
	<table id="mejorespalomas" class="display" style="width:100%">
  </div>
</div>

<br /><br /><br />


</body>
</html>